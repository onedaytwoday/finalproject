<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="class">
	<select id="selectList" resultType="classDto">
		SELECT CLASS_NO, CLASS_TITLE, CLASS_DESC, CLASS_LOC, CLASS_CATEGORY, CLASS_MEMBER_NUM, CLASS_PRICE, CLASS_SALE, MEMBER_ID
		FROM CLASS
		ORDER BY CLASS_NO DESC
	</select>
	
	<select id="classList" parameterType="PagingDto" resultType="classDto">
		SELECT X.rnum,
		X.CLASS_NO, X.CLASS_TITLE, X.CLASS_DESC, X.CLASS_LOC, X.CLASS_CATEGORY, X.CLASS_MEMBER_NUM, X.CLASS_PRICE, X.CLASS_SALE, X.MEMBER_ID
		FROM (
		SELECT ROWNUM AS rnum,
		A.CLASS_NO, A.CLASS_TITLE, A.CLASS_DESC, A.CLASS_LOC, A.CLASS_CATEGORY, A.CLASS_MEMBER_NUM, A.CLASS_PRICE, A.CLASS_SALE, A.MEMBER_ID
		FROM (
		SELECT
		C.CLASS_NO, C.CLASS_TITLE, C.CLASS_DESC, C.CLASS_LOC, C.CLASS_CATEGORY, C.CLASS_MEMBER_NUM, C.CLASS_PRICE, C.CLASS_SALE, C.MEMBER_ID
		FROM CLASS c
		ORDER BY CLASS_NO DESC
		) A
		WHERE ROWNUM <![CDATA[ <= ]]>
		#{pageEnd}
		) X
		WHERE X.rnum <![CDATA[ >= ]]>
		#{pageBegin}
	</select>
	
	<select id="selectOne" resultType="classDto">
		SELECT CLASS_NO, CLASS_TITLE, CLASS_DESC, CLASS_LOC, CLASS_CATEGORY, CLASS_MEMBER_NUM, CLASS_PRICE, CLASS_SALE, MEMBER_ID
		FROM CLASS
		WHERE CLASS_NO = #{class_no}
	</select>
	
	<select id="selectOneByTitle" resultType="classDto">
		SELECT CLASS_NO, CLASS_TITLE, CLASS_DESC, CLASS_LOC, CLASS_CATEGORY, CLASS_MEMBER_NUM, CLASS_PRICE, CLASS_SALE, MEMBER_ID
		FROM CLASS
		WHERE CLASS_TITLE = #{class_title}
	</select>
	
	<select id="userClass" resultType="classDto">
		SELECT C.CLASS_NO, C.CLASS_TITLE, C.CLASS_DESC, C.CLASS_LOC, C.CLASS_CATEGORY, C.CLASS_MEMBER_NUM, 
		C.CLASS_PRICE, C.CLASS_SALE, C.MEMBER_ID
		FROM CLASS C, PAYMENT P
		WHERE C.CLASS_NO = P.CLASS_NO AND P.MEMBER_ID = #{member_id}
	</select>
	
	<insert id="insert" parameterType="classDto">
		INSERT INTO CLASS
		VALUES(CLASS_NO_SEQ.NEXTVAL, #{class_title}, #{class_desc}, #{class_loc}, #{class_category}, #{class_member_num}, #{class_price}, #{class_sale}, #{member_id})
		<selectKey keyProperty="class_no" resultType="int" >
			SELECT CLASS_NO_SEQ.CURRVAL From DUAL
		</selectKey>
	</insert>
	
	<update id="update" parameterType="classDto">
		UPDATE CLASS
		SET CLASS_TITLE = #{class_title}, CLASS_DESC = #{class_desc}, CLASS_LOC = #{class_loc}, CLASS_MEMBER_NUM = #{class_member_num}, CLASS_PRICE = #{class_price}, CLASS_SALE = #{class_sale} 
		WHERE CLASS_NO = #{class_no}
	</update>
	
	<delete id="delete">
		DELETE FROM CLASS
		WHERE CLASS_NO = #{class_no}
	</delete>
	
	<select id="classCount" resultType="int">
		SELECT COUNT(CLASS_NO)
		FROM CLASS
	</select>
</mapper>
